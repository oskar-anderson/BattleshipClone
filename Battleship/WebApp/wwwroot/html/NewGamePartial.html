

<h3>Ruleset:</h3>
<form method="post">
    <div class="form-group">
        <label for="BoardHeight">BoardHeight</label>
        <input class="form-control" type="range" min="10" max="40" name="BoardHeight" id="BoardHeight" value="10"/>
        <label id="BoardHeightIndicator"></label>
    </div>
    <div class="form-group">
        <label for="BoardWidth">BoardWidth</label>
        <input class="form-control" type="range" min="10" max="40" name="BoardWidth" id="BoardWidth" value="10">
        <label id="BoardWidthIndicator"></label>
    </div>
    <div class="form-group">
        <label for="AllowedPlacementType">AllowedPlacementType</label>
        <select class="form-control" name="AllowedPlacementType" id="AllowedPlacementType">
            <option value="0">No overlap</option>
            <option value="1">No sides</option>
            <option value="2" selected="selected">No corners</option>
        </select>
    </div>
    <div>
        <label for="Ships">Ships</label>
        <input class="form-control" type="text" name="Ships" id="Ships" value="1x5n1; 1x4n2; 1x3n3; 1x2n4" />
    </div>
    <div style="color: red" id="rulesetError"></div>
    <button type="button" id="Start" class="btn btn-primary">Start</button>
</form>


<script type="module">
    import GameSettings from "../jsSrc/model/GameSettings.js";
    import GameMethods from "../jsSrc/ServerRestApiGameMethods.js";
    import Rendering from "../jsSrc/Rendering.js";

    main();
    
    function main() {
        let sliderHeight = document.getElementById("BoardHeight");
        let outputHeight = document.getElementById("BoardHeightIndicator");
        outputHeight.innerHTML = sliderHeight.value; // Display the default slider value
    
        // Update the current slider value (each time you drag the slider handle)
        sliderHeight.oninput = function () {
            outputHeight.innerHTML = this.value;
        };
    
        let sliderWidth = document.getElementById("BoardWidth");
        let outputWidth = document.getElementById("BoardWidthIndicator");
        outputWidth.innerHTML = sliderWidth.value;
    
        sliderWidth.oninput = function () {
            outputWidth.innerHTML = this.value;
        };
        
        document.querySelector("#Start").addEventListener("click", launchGame);
    }


    async function launchGame() {
        console.log("in launchGame");
        let settings = getGameSettings();
        console.log("after getGameSettings");
        console.log(settings);
        
        let gameSettingsValidity = await GameMethods.CheckGameSettingsValidity(settings);
        if (!gameSettingsValidity.areSettingsValid) {
            document.getElementById("rulesetError").innerHTML = gameSettingsValidity.errorMessage;
            return;
        }
        let gameViewDTO = await GameMethods.StartGame(settings);
        // let gameViewData = await GameMethods.DoGame(gameViewDTO.GameData);
        console.log("calling render");
        Rendering.renderByName("GameViewController", gameViewDTO.GameData);
    }
    
    function getGameSettings() {
        let height = parseInt(document.getElementById("BoardHeight").value);
        let width = parseInt(document.getElementById("BoardWidth").value);
        let allowedPlacementType = parseInt(document.getElementById("AllowedPlacementType").value);
        let ships = document.getElementById("Ships").value;

        let input = new GameSettings(height, width, allowedPlacementType, ships);
        return input;
    }


</script>
